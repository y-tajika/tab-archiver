# Tab Logger - 開発ログ

## プロジェクト概要
Chrome/Edge拡張機能：開いているタブを一括ブックマーク。フォルダ名は「日付_要約」形式。

## バージョン管理ルール

### セマンティックバージョニング（vX.Y.Z）
- **パッチバージョン (Z)**: バグ修正、小さな改善、ドキュメント更新
  - 変更のたびにインクリメント
  - 例: 1.6.0 → 1.6.1 → 1.6.2
  
- **マイナーバージョン (Y)**: 新機能追加、機能拡張
  - 新機能追加時にインクリメント（パッチバージョンは0にリセット）
  - **マイナーバージョンアップ時は必ずバックアップを作成**
  - 例: 1.6.5 → 1.7.0
  - バックアップ先: `tab-logger-extension-v1.7.0/`
  
- **メジャーバージョン (X)**: 破壊的変更、大規模リファクタリング
  - APIや使い方が大きく変わる場合
  - 例: 1.9.0 → 2.0.0

### バックアップコマンド
```powershell
# マイナーバージョンアップ時
New-Item -ItemType Directory -Path "C:\Users\ZZ22397\Downloads\tab-logger-extension-v1.X.0" -Force
Copy-Item "C:\Users\ZZ22397\Downloads\tab-logger-extension\*" -Destination "C:\Users\ZZ22397\Downloads\tab-logger-extension-v1.X.0\" -Recurse
```

---

## 最新バージョン

### v1.6.0 - 手動フォルダ名入力機能追加 (2026-01-15)
**新機能：**
- ポップアップUI追加（popup.html, popup.css, popup.js）
- フォルダ名を手動で入力・編集可能に
- 自動生成された名前をプリセットとして表示
- 2つの保存方法を提供：
  1. **拡張機能アイコンクリック** → ポップアップでフォルダ名を編集して保存
  2. **Alt+Shift+S** → 自動命名で即座に保存（従来通り）

**実装内容：**
```javascript
// カスタムフォルダ名をサポート
async function saveAllTabs(customFolderName = null)

// ポップアップ用のフォルダ名生成API
async function generateFolderName()

// メッセージハンドラー追加
chrome.runtime.onMessage.addListener()
```

**ファイル構成：**
- `popup.html`: ポップアップUI（350px幅、フォルダ名入力フォーム）
- `popup.css`: モダンなデザイン（青系、フォーカス時アニメーション）
- `popup.js`: フォルダ名生成・保存処理
- `manifest.json`: default_popup追加

**UI/UX改善：**
- タブ数を表示（「14 タブを保存」）
- 自動生成された名前を編集可能
- Enterキーで保存
- ショートカットヒント表示

**バージョン管理：**
- v1.5.0 → v1.6.0（マイナーバージョンアップ）
- バックアップ作成: `tab-logger-extension-v1.6.0/`

---

## 開発履歴

### v1.5.0 - 要約アルゴリズム大幅改善 (2026-01-14)
**改善内容：**
- 3文字以上の単語を優先抽出
- 長い単語に高スコア（6文字以上は特に重視）
- 漢字3文字以上を重視（日本語の意味を保持）
- カタカナ技術用語を優先（プロジェクト名などを認識）
- 英数字混在を重視（バージョン番号付きプロジェクト名）
- スコアが低い場合のみ2文字単語を補完

**結果：**
- より意味のあるフォルダ名を生成
- 例：`01-14_開発環境構築_プロジェクト管理`

**技術詳細：**
```javascript
// 長さボーナス
if (word.length >= 6) score += 8;
else if (word.length >= 4) score += 4;

// 漢字ボーナス
if (kanjiCount >= 3) score += 6;
else if (kanjiCount >= 2) score += 3;
```

**ショートカットキー：**
- Alt+Shift+S（Ctrl+Shift+Bは予約済みのため変更）

---

## 開発履歴

### v1.0.0 - 初期版
- 基本的なタブブックマーク機能
- 荒削りなコード

### v1.1.0～v1.2.0 - リファクタリング
**改善点：**
- コード可読性向上（変数名の改善、JSDocコメント追加）
- 関数分割と責任の明確化
- エラーハンドリング改善

**問題：**
- インラインスクリプトによるCSPエラー
- 通知API使用時のエラー

### v1.2.1～v1.2.4 - バグ修正
**修正内容：**
- CSPエラー解決（インラインスクリプト→外部ファイル化）
- 通知API削除（コンソールログに統一）
- ショートカットキー変更（Ctrl+Shift+L → Ctrl+Shift+B）
- 保存先を「その他のお気に入り > Tab_Logger」に固定

**トラブル：**
- ページアクセス時のタイムアウトエラー多発
- 5秒タイムアウトを追加したが根本解決にならず

### v1.3.0 - 設計変更（重要）
**大きな方針転換：**
- ページコンテンツ抽出を完全削除
- タブの基本情報（title, url）のみ使用
- content.js 削除
- extractPageData() 削除

**理由：**
- ページアクセスによるタイムアウトエラーが多すぎる
- そもそもタイトルとURLだけで十分

**結果：**
- エラーゼロ
- 処理速度が大幅向上（14タブが1秒以内）

### v1.3.1 - 要約改善（失敗）
**試み：**
- ストップワード拡張
- キーワード数増加（top4 → top5）

**結果：**
- フォルダ名が「KICSiOS開発・Powered・by・Box」のようにセンスがない
- ノイズワード（Powered, by, Box等）が残る

### v1.4.0 - 抜本的コード整理
**改善観点：**

1. **冗長コード・ファイル削除**
   - content.js 完全削除
   - extractPageData() 削除
   - summarizeWithLLM() 削除（OpenAI API未使用）
   - 重複したbuildFolderSummary()定義削除

2. **コード構造整理**
   - セクションコメントで分割
   - 定数を上部に集約
   - 関数名明確化

3. **パーミッション整理**
   - 不要なパーミッション削除：scripting, notifications, host_permissions

4. **行数削減**
   - 390行 → 283行（-27%）
   - ファイル数：6個 → 4個

5. **UI改善**
   - 設定画面のセクション分割
   - モダンなデザイン

### v1.4.1 - 要約とフォーマット改善（現行版）
**変更内容：**

1. **日付フォーマット変更**
   - `2026-01-14 1733` → `01-14`
   - 年と時刻を削除（月日のみ）

2. **要約アルゴリズム大幅改善**
   - スコアリング導入：
     - 3文字以上の単語を優先
     - 漢字2文字以上を含む単語を優先
   - ひらがな除外（カタカナ・漢字・英数字のみ）
   - キーワード数削減：5個 → 3個
   - 区切り文字変更：`・` → `_`

**結果：**
- Before: `2026-01-14 1733_KICSiOS開発・Powered・by・Box`
- After: `01-14_KICSiOS_開発者_プロジェクト`

## 主要な技術的決定

### ページコンテンツを抽出しない理由
1. タイムアウトエラーが多発（ローカルホスト、重いページ）
2. タブのタイトルだけで十分な要約が可能
3. パフォーマンス向上（処理速度10倍以上）
4. 不要なパーミッション削減

### 通知を使わない理由
1. Service Workerで`alert()`が使えない
2. `chrome.notifications.create()`でアイコンエラー
3. コンソールログで十分（開発者向けツール）

### 保存先を固定した理由
- 「その他のお気に入り > Tab_Logger」に統一
- ユーザーが保存先を選ぶ必要がない
- シンプルな設計

## トラブルシューティング履歴

### CSPエラー
**エラー：**
```
Refused to execute inline script because it violates CSP
```

**原因：**
- options.htmlにインラインスクリプト/スタイルが残っていた

**解決：**
- 全てを外部ファイル化（options.js, options.css）

### 構文エラー（括弧の不一致）
**エラー：**
```
Uncaught SyntaxError: Unexpected end of input
```

**原因：**
- 編集ミスで`}`が不足

**解決：**
- PowerShellで括弧のバランスチェック

### ディレクトリ名の混乱
**問題：**
- バージョンごとにディレクトリ名変更（非効率）

**解決：**
- ディレクトリ名を`tab-logger-extension`に固定
- バージョンはmanifest.jsonのみで管理

## 現在のファイル構成

```
tab-logger-extension/
├── manifest.json        # 拡張機能メタデータ
├── background.js        # メイン処理（283行）
├── options.html         # 設定画面HTML
├── options.css          # 設定画面スタイル
└── options.js           # 設定画面ロジック
```

## 設定項目

- **日付フォーマット**: MM-DD（デフォルト）
- **時刻表示**: オフ（デフォルト）
- **要約最大文字数**: 30文字
- **タイトル最大文字数**: 100文字
- **保存後タブを閉じる**: オフ

## ショートカット

- **Ctrl+Shift+B**: 現在のウィンドウの全タブを保存

## 今後の改善案

1. ✅ フォルダ名の要約改善（v1.4.1で対応済み）
2. 🔲 重複タブの除外オプション
3. 🔲 特定URLパターンの除外設定
4. 🔲 保存履歴の表示
5. 🔲 エクスポート/インポート機能

## 開発環境

- OS: Windows
- ブラウザ: Edge
- ターミナル: PowerShell
- 開発ツール: VS Code + GitHub Copilot

## メモ

- Service Workerではalert()が使えない
- chrome://やedge://のタブは保存できない（仕様）
- ページアクセスは不要（タイトルとURLで十分）
- 要約はスコアリング方式が効果的
